<script>
    import { onMount } from 'svelte';
    import { fade } from 'svelte/transition';

    import { callEvent } from "./utils/callEvent"
    import { useEvent } from "./utils/useEvent"

    import SpawnPoint from './components/SpawnPoint.svelte';

    var spawnPointsDisplay = [
        { active: false, background: 'rgba(131, 112, 255, 0.3)', state: 1 },
        { active: false, background: 'rgba(157, 92, 31, 0.5)', state: 2 },
        { active: false, background: 'rgba(201, 55, 143, 0.5)', state: 2 },
        { active: false, background: 'rgba(11, 80, 84, 0.5)', state: 3 },
        { active: false, background: 'rgba(150, 21, 21, 0.5)', state: 3 },
        { active: false, background: 'rgba(11, 65, 171, 0.5)', state: 2 },
        { active: false, background: 'rgba(166, 46, 103, 0.5)', state: 3 },
    ]

    var showUI = false

    useEvent("SetVisible", (bool) => {
        showUI = bool
    })

    useEvent("SetupMenu", (settings) => {
        spawnPointsDisplay.forEach((_, idx) => {
            spawnPointsDisplay[idx].state = settings[idx].type
            spawnPointsDisplay[idx].values = settings[idx].values
        })
    })

    onMount(() => {
        setTimeout(() => {
            spawnPointsDisplay.forEach((_, idx) => {
                (function (idx) {
                    setTimeout(function () {spawnPointsDisplay[idx].active = true},idx*15)
                }(idx))
            })
        }, 10)
    })
    
    const handleSelection = ({ detail: index }) => {
        var itr = 0;
        spawnPointsDisplay.forEach((val, idx) => {
            if (idx !== index)
            {
                (function (idx) {
                    setTimeout(function () {spawnPointsDisplay[idx].active = false},itr*30)
                    itr++;
                }(idx))
            }
        })
        
        setTimeout(function () {
            showUI = false
            callEvent("SelectSpawn", index)
        }, spawnPointsDisplay.length*30)
    }
</script>

{#if showUI}
    <main transition:fade>
    <figure class="border"></figure>

    <figure class="content">
        <header>
            <div class="group">
                <div class="logo">
                    <svg width="137" height="52" viewBox="0 0 137 52" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M15.7211 7.72426C15.7211 6.42359 15.4368 5.31463 14.8759 4.39364C14.3112 3.47264 13.4812 2.76592 12.3783 2.26971C11.2791 1.7735 9.91852 1.52539 8.30018 1.52539H1.6676V20.4716H6.28008V13.8931H8.30018C9.91852 13.8931 11.2791 13.6449 12.3783 13.1487C13.4774 12.6525 14.3112 11.9383 14.8759 11.0098C15.4406 10.0813 15.7211 8.98358 15.7211 7.7205V7.72426ZM10.4832 9.50986C9.95642 9.92337 9.22874 10.1339 8.30018 10.1339H6.28008V5.28832H8.30018C9.22874 5.28832 9.95642 5.49507 10.4832 5.91234C11.0101 6.32961 11.2754 6.93107 11.2754 7.72426C11.2754 8.51744 11.0101 9.09635 10.4832 9.50986Z" fill="white"/>
                        <path d="M14.5731 20.4714H19.7844L21.5657 16.8174H27.6563L29.4452 20.4714H34.6831L24.6167 0.333496L14.5731 20.4714ZM26.7467 13.3252H22.4981L24.6167 8.47961L26.7467 13.3252Z" fill="white"/>
                        <path d="M48.4105 13.1072C49.5021 12.5847 50.3283 11.8592 50.893 10.9269C51.4577 9.99841 51.7382 8.92704 51.7382 7.72035C51.7382 6.51366 51.4539 5.41598 50.893 4.48747C50.3283 3.55895 49.5021 2.83343 48.4105 2.30715C47.319 1.78087 45.9546 1.52148 44.3173 1.52148H37.3588V20.4677H41.9712V13.8891H43.3622L47.482 20.4677H52.8866L47.9064 13.3178C48.0808 13.2501 48.2476 13.1824 48.4105 13.1035V13.1072ZM41.9712 5.39343H43.9913C44.6091 5.39343 45.1435 5.49117 45.5869 5.6904C46.0342 5.88964 46.3753 6.17157 46.6103 6.54373C46.8452 6.91213 46.9665 7.35947 46.9665 7.882C46.9665 8.40452 46.849 8.85186 46.6103 9.22026C46.3753 9.58866 46.0342 9.8706 45.5869 10.0586C45.1397 10.2465 44.6091 10.3443 43.9913 10.3443H41.9712V5.38967V5.39343Z" fill="white"/>
                        <path d="M53.6522 20.4714H58.8635L60.6448 16.8174H66.7354L68.5243 20.4714H73.7621L63.692 0.333496L53.6484 20.4714H53.6522ZM65.8258 13.3252H61.5771L63.6958 8.47961L65.8258 13.3252Z" fill="white"/>
                        <path d="M81.0463 1.52539H76.4376V20.4716H88.7174V16.547H81.0463V1.52539Z" fill="white"/>
                        <path d="M96.1381 1.52539H91.5256V20.4716H103.805V16.547H96.1381V1.52539Z" fill="white"/>
                        <path d="M109.673 1.52539H106.618V20.4716H109.673H111.037H119.307V16.7087H111.037V12.3518H118.761V8.67157H111.037V5.28832H119.307V1.52539H111.037H109.673Z" fill="white"/>
                        <path d="M128.365 16.547V1.52539H123.752V20.4716H136.032V16.547H128.365Z" fill="white"/>
                        <path d="M6.38954 41.8313C6.91635 42.6696 7.61372 43.3049 8.47785 43.741C9.34198 44.1733 10.2933 44.3913 11.328 44.3913C12.2376 44.3913 13.0373 44.2748 13.7308 44.0379C14.4206 43.8049 15.0422 43.4966 15.588 43.1169C16.1337 42.7373 16.6151 42.3313 17.0358 41.899V46.8235C16.2702 47.4174 15.4364 47.8873 14.5268 48.2294C13.6171 48.5715 12.4612 48.7444 11.0627 48.7444C9.53527 48.7444 8.12538 48.5113 6.83297 48.0414C5.54057 47.5715 4.43008 46.8949 3.50531 46.0115C2.57675 45.1281 1.86044 44.0793 1.34878 42.8726C0.840914 41.6621 0.583191 40.3201 0.583191 38.839C0.583191 37.3579 0.837124 36.0159 1.34878 34.8054C1.85665 33.595 2.57675 32.5499 3.50531 31.6665C4.43387 30.7831 5.54436 30.1065 6.83297 29.6366C8.12159 29.1667 9.53527 28.9336 11.0627 28.9336C12.465 28.9336 13.6171 29.1065 14.5268 29.4486C15.4364 29.7907 16.274 30.2606 17.0358 30.8545V35.779C16.6151 35.3467 16.1337 34.937 15.588 34.546C15.0422 34.1588 14.4244 33.8506 13.7308 33.625C13.0373 33.3995 12.2376 33.2867 11.328 33.2867C10.2895 33.2867 9.33819 33.5047 8.47785 33.937C7.61372 34.3693 6.91635 35.0009 6.38954 35.8317C5.86272 36.6624 5.59742 37.6624 5.59742 38.8352C5.59742 40.0081 5.86272 40.9855 6.38954 41.8275V41.8313Z" fill="white"/>
                        <path d="M26.1732 29.3657V48.3119H21.4811V29.3657H26.1732Z" fill="white"/>
                        <path d="M28.9822 29.3657H44.1007V33.4519H38.8326V48.3119H34.2201V33.4519H28.9822V29.3657Z" fill="white"/>
                        <path d="M63.7211 29.3657L57.0354 40.5981V48.3119H52.3433V40.6244L45.6577 29.3657H50.9524L54.6894 36.4856L58.4264 29.3657H63.7211Z" fill="white"/>
                        <path d="M111.226 32.147C110.897 32.3124 110.707 32.7146 110.574 33.0003C110.423 33.3274 110.305 33.6657 110.245 34.0116C110.18 34.3799 111.329 34.6882 111.435 34.3348C111.533 33.9965 111.639 33.6619 111.799 33.3349C111.939 33.0454 112.212 32.7184 112.193 32.4101C112.193 32.4101 112.189 32.4101 112.185 32.4101C112.147 32.1169 111.484 32.0154 111.222 32.147H111.226Z" fill="#57FFAF"/>
                        <path d="M128.588 36.8876C129.448 36.711 130.282 36.4027 131.025 36.008C131.863 35.5644 133.026 34.7863 133.053 33.8916C133.076 33.0909 132.086 32.6473 131.226 32.5834C130.04 32.4932 129.088 33.2187 128.391 33.948C127.91 34.4517 127.318 35.2411 126.924 36.0757C126.242 36.6922 125.537 37.2899 124.775 37.8425C124.328 38.1658 123.843 38.5342 123.377 38.8386C123.191 38.9589 122.501 39.4063 122.524 39.1131C122.524 39.098 122.532 39.083 122.535 39.068C122.74 38.0755 123.112 37.1094 123.445 36.1396C123.707 35.3727 124.351 34.1886 123.707 33.4818C123.491 33.245 123.081 33.0984 122.706 33.1473C121.872 33.2525 121.235 33.9743 120.705 34.4667C120.011 35.1133 119.367 35.7975 118.711 36.4666C117.821 37.3763 116.903 38.2748 115.865 39.0717C115.816 39.1093 115.634 39.2409 115.581 39.2747C115.494 39.3386 115.353 39.4552 115.19 39.5792C115.266 39.2334 115.391 38.8725 115.437 38.7221C115.619 38.147 115.85 37.5831 116.07 37.0155C116.509 35.8764 117.07 34.7637 117.476 33.6172C117.605 33.2563 116.559 33.0082 116.327 33.3052C115.891 33.8615 115.501 34.4592 115.16 35.0795C114.811 35.7148 114.341 36.305 113.784 36.8313C113.655 36.9553 113.526 37.0794 113.394 37.1921C112.844 37.6658 110.764 39.4627 110.146 40.0153C109.964 40.1807 108.906 40.8949 108.876 40.5716C108.876 39.8649 109.301 38.9063 109.49 38.4214C109.843 37.5229 110.559 36.6057 110.722 35.6809C110.775 35.384 110.013 35.1622 109.763 35.3577C109.077 35.899 108.641 36.7147 108.258 37.4177C107.838 38.1808 107.481 38.9928 107.337 39.8198C107.326 39.895 107.311 39.9702 107.299 40.0453C106.318 40.9513 105.351 41.9362 104.237 42.7369C103.995 42.9136 103.703 43.1166 103.418 43.1955C103.085 43.2857 102.876 43.1166 102.831 42.8158C102.823 42.7595 102.823 42.6993 102.82 42.6429C102.82 42.5715 102.816 42.5038 102.82 42.4324C102.82 42.2933 102.835 42.1505 102.854 42.0114C102.892 41.7332 102.956 41.4588 103.032 41.1844C103.07 41.0378 103.111 40.8874 103.153 40.7408C103.634 39.0078 104.173 37.3199 104.832 35.6471C105.321 35.2787 105.776 34.8915 106.185 34.5682C107.572 33.4856 108.941 32.3879 110.161 31.1775C111.374 29.9783 112.537 28.6325 113.208 27.174C113.432 26.689 113.598 26.1026 113.242 25.644C112.871 25.1666 112.067 24.941 111.393 24.9861C109.82 25.0951 108.444 26.5311 107.584 27.5085C106.522 28.7115 105.708 30.0422 104.969 31.388C104.248 32.6962 103.566 34.0344 102.998 35.399C102.437 35.8464 101.796 36.2975 101.08 36.3538C100.493 36.3989 101.209 36.82 101.421 36.8538C101.774 36.9102 102.115 36.8989 102.452 36.8388C102.281 37.3387 102.134 37.8387 102.009 38.3462C101.201 39.0943 100.371 39.8236 99.4541 40.4852C99.0068 40.8085 98.4952 41.252 98.01 41.5377C97.8168 41.6505 97.1535 41.9625 97.2104 41.7107C97.415 40.7182 97.7864 39.7521 98.12 38.7823C98.3815 38.0154 99.0258 36.8313 98.3815 36.1245C98.1654 35.8877 97.7561 35.7411 97.3809 35.79C96.5471 35.8952 95.9104 36.617 95.3798 37.1094C94.6862 37.756 94.0419 38.4402 93.3862 39.1093C92.4955 40.019 91.5784 40.9175 90.5399 41.7144C90.4906 41.752 90.3049 41.8836 90.2556 41.9212C90.1685 41.9851 90.0282 42.1016 89.8653 42.2257C89.9411 41.8798 90.0661 41.5189 90.1116 41.3686C90.2935 40.7934 90.5247 40.2295 90.7445 39.6619C91.1842 38.5229 91.7451 37.4102 92.1506 36.2636C92.2795 35.9027 91.2335 35.6546 91.0023 35.9516C90.8507 36.1433 90.7066 36.3388 90.5664 36.5418C89.8956 37.1809 89.0693 37.8387 88.2659 38.3575C87.8565 38.6206 87.4358 38.865 86.9924 39.083C87.3146 38.1545 87.5912 37.2147 87.8186 36.2674C88.1256 34.978 88.3341 33.6773 88.4629 32.3729C88.5956 31.0309 88.7131 29.6174 88.3492 28.3055C87.7656 26.2229 85.4726 24.7944 82.8158 25.6139C81.3756 26.0575 80.1665 27.001 79.0826 27.8769C77.8698 28.8581 76.7744 29.9332 75.7549 31.0534C73.6136 33.4067 71.5631 35.9403 70.1987 38.6545C69.5051 40.0341 68.9935 41.4663 68.8002 42.9399C68.641 44.1654 68.5576 45.3871 69.7705 46.2141C69.96 46.3419 70.7521 46.4021 70.4375 46.0675C69.6795 45.2593 70.1153 43.782 70.3465 42.8497C70.6156 41.767 71.0022 40.6957 71.5025 39.6657C71.9611 38.7221 72.4993 37.8049 73.0905 36.9102C72.9124 37.2673 72.7532 37.632 72.613 38.0154C72.1089 39.41 71.7564 40.831 71.5859 42.2708C71.4229 43.6391 71.4267 45.0187 71.6427 46.372C71.836 47.5862 72.1241 48.9809 72.8783 50.0372C74.3791 52.1423 77.7485 51.601 79.8103 50.2327C82.1336 48.6952 83.57 46.2292 84.7676 44.0564C85.4499 42.8158 86.0525 41.5415 86.5603 40.2483C87.1705 40.1656 87.8148 39.8687 88.281 39.6469C88.5691 39.5078 88.8457 39.3574 89.1186 39.1995C88.8571 39.8198 88.6335 40.4438 88.4554 41.0603C88.2848 41.643 88.065 42.5038 88.5084 43.0226C88.8268 43.3948 89.5355 43.5526 90.0548 43.3684C90.7408 43.1241 91.4268 42.455 91.9498 42.0114C92.2947 41.7182 92.6396 41.425 92.9655 41.1167C93.9471 40.1769 94.8492 39.1845 95.8005 38.2221C96.0809 37.9364 96.369 37.6545 96.6608 37.3726C96.7063 37.3275 96.7972 37.2297 96.9109 37.1132C96.7555 37.4628 96.5623 37.8049 96.4561 38.0492C96.1643 38.7108 95.8725 39.3687 95.6451 40.0491C95.3381 40.9739 94.9098 42.1768 96.2325 42.6204C97.415 43.0188 98.5975 42.267 99.4275 41.5904C100.182 40.9776 100.951 40.3724 101.713 39.7596C101.633 40.2859 101.576 40.816 101.558 41.3498C101.52 42.47 101.675 44.5112 103.737 43.985C104.65 43.7519 105.457 42.985 106.128 42.4512C106.625 42.0565 107.099 41.643 107.569 41.2257C107.599 41.252 107.629 41.2783 107.667 41.3047C108.164 41.6618 108.918 41.7558 109.543 41.549C110.225 41.3235 110.695 40.8122 111.18 40.3761C111.556 40.0416 111.927 39.707 112.287 39.3649C112.837 38.8462 113.401 38.3424 113.966 37.8387C113.902 38.0342 113.841 38.2297 113.784 38.4214C113.614 39.0041 113.394 39.8649 113.837 40.3837C114.156 40.7558 114.864 40.9137 115.384 40.7295C116.07 40.4852 116.752 39.816 117.279 39.3724C117.624 39.0792 117.968 38.786 118.294 38.4778C119.276 37.538 120.178 36.5456 121.129 35.5832C121.41 35.2975 121.698 35.0156 121.99 34.7336C122.035 34.6885 122.126 34.5908 122.24 34.4743C122.084 34.8239 121.891 35.1659 121.785 35.4103C121.493 36.0719 121.201 36.7298 120.974 37.4102C120.667 38.3349 120.239 39.5379 121.561 39.9814C122.744 40.3799 123.926 39.6281 124.756 38.9514C125.332 38.4815 125.92 38.0191 126.5 37.5568C126.462 38.1996 126.667 38.7823 127.273 39.1845C127.959 39.6356 129.016 39.8048 129.881 39.5566C130.46 39.3912 131.211 39.0529 131.677 38.7372C132.499 38.1808 133.007 37.7259 133.079 37.3876C133.136 37.1245 132.56 36.9215 132.329 37.0794C131.624 37.5568 130.923 38.0605 130.153 38.4665C129.835 38.6319 129.301 38.9101 128.899 38.9138C128.262 38.9213 128.277 38.5266 128.323 38.0831C128.365 37.6808 128.459 37.2824 128.592 36.8876H128.588ZM129.881 34.6923C130.233 34.3013 130.798 33.6322 131.381 33.4518C132.003 33.2638 131.7 33.8427 131.518 34.1434C131.332 34.4517 131.025 34.7224 130.726 34.9592C130.206 35.3689 129.63 35.6546 129.024 35.8877C129.259 35.4629 129.543 35.0607 129.877 34.6885L129.881 34.6923ZM110.222 26.8319C110.419 26.6702 111.552 25.6853 111.829 25.7943C112.268 25.971 111.541 27.08 111.396 27.3243C110.718 28.4709 109.824 29.5197 108.823 30.4971C107.936 31.3617 106.97 32.1699 105.999 32.9706C107.046 30.7978 108.19 28.5273 110.225 26.8319H110.222ZM84.093 41.3159C83.1455 43.376 81.9933 45.4435 80.5266 47.3043C79.8444 48.1689 79.0409 48.9922 78.0479 49.6275C77.5552 49.9432 77.0132 50.1989 76.4296 50.3718C75.6033 50.6161 74.8718 50.4883 74.5156 49.9883C73.7727 48.9433 73.534 47.575 73.3596 46.372C73.1587 44.9962 73.1701 43.5902 73.3672 42.2031C73.5491 40.9024 73.8902 39.613 74.3488 38.3537C74.8264 37.0418 75.2471 35.7073 75.7928 34.4179C75.8762 34.2262 75.5048 34.0607 75.1978 34.0495C75.2584 33.978 75.3153 33.9029 75.3721 33.8277C76.9677 31.8616 78.7074 29.952 80.7881 28.3092C81.7432 27.5574 82.8044 26.7229 84.0589 26.3507C84.779 26.1364 85.4006 26.1364 85.9009 26.6326C86.2799 27.0048 86.5035 27.4972 86.6437 27.9671C87.2767 30.1136 86.7498 32.6172 86.2761 34.79C85.791 37.0079 85.0709 39.1958 84.0968 41.3159H84.093Z" fill="#57FFAF"/>
                    </svg>                    
                </div>

                <!-- <div class="group">
                    <button class="close--button">
                        <svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M4.49449 4.49449C4.65103 4.33773 4.83693 4.21337 5.04157 4.12852C5.24621 4.04367 5.46557 4 5.6871 4C5.90863 4 6.12799 4.04367 6.33263 4.12852C6.53727 4.21337 6.72317 4.33773 6.8797 4.49449L13.0002 10.6128L19.1208 4.49449C19.2774 4.33788 19.4633 4.21364 19.668 4.12888C19.8726 4.04412 20.0919 4.0005 20.3134 4.0005C20.5349 4.0005 20.7542 4.04412 20.9588 4.12888C21.1635 4.21364 21.3494 4.33788 21.506 4.49449C21.6626 4.65111 21.7869 4.83704 21.8716 5.04166C21.9564 5.24629 22 5.46561 22 5.6871C22 5.90859 21.9564 6.1279 21.8716 6.33253C21.7869 6.53716 21.6626 6.72309 21.506 6.8797L15.3877 13.0002L21.506 19.1208C21.8223 19.4371 22 19.8661 22 20.3134C22 20.7607 21.8223 21.1897 21.506 21.506C21.1897 21.8223 20.7607 22 20.3134 22C19.8661 22 19.4371 21.8223 19.1208 21.506L13.0002 15.3877L6.8797 21.506C6.5634 21.8223 6.13441 22 5.6871 22C5.23978 22 4.81079 21.8223 4.49449 21.506C4.17819 21.1897 4.0005 20.7607 4.0005 20.3134C4.0005 19.8661 4.17819 19.4371 4.49449 19.1208L10.6128 13.0002L4.49449 6.8797C4.33773 6.72317 4.21337 6.53727 4.12852 6.33263C4.04367 6.12799 4 5.90863 4 5.6871C4 5.46557 4.04367 5.24621 4.12852 5.04157C4.21337 4.83693 4.33773 4.65103 4.49449 4.49449Z" fill="white"/>
                        </svg>                        
                    </button>
                </div> -->
            </div>

            <div class="bottom--bar">
                <span class="bar--dot"></span>
                <span class="bar"></span>
                <span class="bar--dot"></span>
            </div>
        </header>

        <section class="spawn--selection">
            {#each spawnPointsDisplay as data, idx}
                {#if data?.active}
                    <SpawnPoint on:click={handleSelection} values={data.values} state={data.state} {idx} colours={{ background: data?.background }} />
                {/if}
            {/each}
        </section>
    </figure>
    </main>
{/if}

<style>
    .spawn--selection {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 10px;
        height: 710px;
        margin-top: 68px;
    }
    .content {
        width: calc(100% - 125px - 125px);
        margin-inline: auto;
    }
    .content header {
        margin-top: 100px;
        margin-inline: 60px;
    }
    .content header .group {
        display: flex;
        justify-content: space-between;
    }
    .content header .logo {
        margin-bottom: 20px;
    }
    .bottom--bar {
        display: flex;
        gap: 8px;
        align-items: center;
    }
    .bottom--bar .bar--dot {
        width: 3px;
        height: 3px;
        background-color: rgba(255, 255, 255, 0.5);
        display: block;
    }
    .bottom--bar .bar {
        display: block;
        width: 100%;
        height: 1px;
        background-color: rgba(255, 255, 255, 0.1);
    }
    .close--button {
        width: 44px;
        height: 44px;

        margin: 5px;

        border-radius: 12px;

        background: rgba(255, 255, 255, 0.15);
        outline: 2px solid rgba(255, 255, 255, 0.15);
        border-radius: 12px;

        outline-offset: 3px;

        position: relative;

        cursor: pointer;
    }

    .close--button:hover {
        background-color: rgba(255, 255, 255, 0.85);
        outline-color: rgba(255, 255, 255, 0.85);
    }

    .close--button svg {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
    }
    .border {
        position: absolute;
        inset: 20px;
        border-radius: 20px;

        border: 1px solid rgba(255, 255, 255, 0.15);
    }
    main {
        position: absolute;
        inset: 0;

        background-image: url('../static/bg.png');
        background-size: cover;
        background-position: center;
    }
</style>